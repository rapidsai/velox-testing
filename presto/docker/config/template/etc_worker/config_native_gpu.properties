# This node is a worker; it executes tasks but doesn't coordinate queries.
coordinator=false
# Worker REST/HTTP port for internal and admin endpoints.
http-server.http.port=8080
# Address of the coordinator's discovery service for registration.
discovery.uri=http://presto-coordinator:8080

# Set Presto version string to match the coordinator for compatibility.
presto.version=testversion

# Total system memory available to Presto native process on this node (GB).
system-memory-gb={{ .NativeSystemMemGb }}
# Memory pool reserved for queries on this node (GB).
query-memory-gb={{ .NativeQueryMemGb }}
# Memory limit per node enforced by the coordinator for this worker.
query.max-memory-per-node={{ .NativeQueryMemGb }}GB
# Use the shared memory arbitrator to coordinate memory between tasks.
memory-arbitrator-kind=SHARED

# Limit parallel drivers per task on GPU nodes to avoid oversubscribing GPUs.
task.max-drivers-per-task=2

# Collect runtime metrics from the native engine for debugging and tuning.
runtime-metrics-collection-enabled=true
# Enable memory pushback to respect container limits and avoid OOM kills.
# Limit Velox memory to below container limit to maintain safety margin.
system-mem-pushback-enabled=true
system-mem-limit-gb={{ sub .ContainerMemoryGb .GeneratorParameters.MemoryPushBackStartBelowLimitGb }}
system-mem-shrink-gb=20

# Optimize for single-node execution when the entire query can run locally.
single-node-execution-enabled=true
