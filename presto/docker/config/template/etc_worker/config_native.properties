# This node is a worker; it executes tasks but doesn't coordinate queries.
coordinator=false
# Worker REST/HTTP port for internal and admin endpoints.
http-server.http.port=8080
# Address of the coordinator's discovery service for registration.
discovery.uri=http://presto-coordinator:8080

# Set Presto version string to match the coordinator for compatibility.
presto.version=testversion

# Total system memory available to Presto native process on this node (GB).
system-memory-gb={{ .NativeSystemMemGb }}
# Memory pool reserved for queries on this node (GB).
query-memory-gb={{ .NativeQueryMemGb }}
# Memory limit per node enforced by the coordinator for this worker.
query.max-memory-per-node={{ .NativeQueryMemGb }}GB
# Use the shared memory arbitrator to coordinate memory between tasks.
memory-arbitrator-kind=SHARED

# Parallel driver cap per task; templated to fully utilize vCPUs on CPU nodes.
task.max-drivers-per-task={{ .VCPUPerWorker }}

# Collect runtime metrics from the native engine for debugging and tuning.
runtime-metrics-collection-enabled=true
# Enable memory pushback to respect container limits and avoid OOM kills.
# Limit Velox memory to below container limit to maintain safety margin.
system-mem-pushback-enabled=true
system-mem-limit-gb={{ sub .ContainerMemoryGb .GeneratorParameters.MemoryPushBackStartBelowLimitGb }}
system-mem-shrink-gb=20

# Optimize for single-node execution when the entire query can run locally.
single-node-execution-enabled=true

# Enable cuDF (CPU mode will ignore this setting)
cudf.enabled=true
cudf.exchange=false
# Port number currently must be exactly 3 more than server port (ignored if cudf.exchange is false)
cudf.exchange.server.port=8083
cudf.memory_resource=async

# Turn on to use intra-node exchange optimization.
# NOTE: In cudf exchange 20260212 branch, this is needed for UCX to use nvlink.
#cudf.intra_node_exchange=true

# Turn on to use rebatching to minimum of 100m rows (currently only before aggregations).
#cudf.batch_size_min_threshold=100000000

# =================================================================================
# NOTE: This setting is not yet propagated to the worker properly because only a fixed set of query configs are supported.
#       https://github.com/prestodb/presto/blob/a62672886152c8c6b61cf301d246f217d850e357/presto-native-execution/presto_cpp/main/PrestoToVeloxQueryConfig.cpp#L106-L224
#       As a result, this needs to be hardcoded right now.

# Turn on to use 100M rows per chunk for cudf partitioned output.
#cudf.partitioned_output_batch_rows=100000000
# =================================================================================

async-data-cache-enabled=false
