{
  "Q1": "SELECT l_returnflag, l_linestatus, sum(l_quantity) AS sum_qty, sum(l_extendedprice) AS sum_base_price, sum(l_extendedprice * (1 - l_discount)) AS sum_disc_price, sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge, avg(l_quantity) AS avg_qty, avg(l_extendedprice) AS avg_price, avg(l_discount) AS avg_disc, count(*) AS count_order FROM lineitem WHERE l_shipdate <= DATE '1998-09-02' GROUP BY l_returnflag, l_linestatus ORDER BY l_returnflag, l_linestatus",
  "Q2": "WITH europe_parts AS (SELECT p.p_partkey, p.p_mfgr, ps.ps_supplycost, s.s_name, s.s_acctbal, s.s_address, s.s_phone, s.s_comment, n.n_name FROM part p JOIN partsupp ps ON p.p_partkey = ps.ps_partkey JOIN supplier s ON ps.ps_suppkey = s.s_suppkey JOIN nation n ON s.s_nationkey = n.n_nationkey JOIN region r ON n.n_regionkey = r.r_regionkey WHERE p.p_size = 15 AND p.p_type LIKE '%BRASS' AND r.r_name = 'EUROPE'), min_cost AS (SELECT p_partkey, min(ps_supplycost) AS min_supplycost FROM europe_parts GROUP BY p_partkey) SELECT ep.s_acctbal, ep.s_name, ep.n_name, ep.p_partkey, ep.p_mfgr, ep.s_address, ep.s_phone, ep.s_comment FROM europe_parts ep JOIN min_cost mc ON ep.p_partkey = mc.p_partkey AND ep.ps_supplycost = mc.min_supplycost ORDER BY s_acctbal DESC, n_name, s_name, p_partkey LIMIT 100",
  "Q3": "SELECT l_orderkey, sum(l_extendedprice * (1 - l_discount)) AS revenue, o_orderdate, o_shippriority FROM customer JOIN orders ON c_custkey = o_custkey JOIN lineitem ON o_orderkey = l_orderkey WHERE c_mktsegment = 'BUILDING' AND o_orderdate < DATE '1995-03-15' AND l_shipdate > DATE '1995-03-15' GROUP BY l_orderkey, o_orderdate, o_shippriority ORDER BY revenue DESC, o_orderdate LIMIT 10",
  "Q4": "SELECT o_orderpriority, count(*) AS order_count FROM orders WHERE o_orderdate >= DATE '1993-07-01' AND o_orderdate < DATE '1993-10-01' AND o_orderkey IN (SELECT l_orderkey FROM lineitem WHERE l_commitdate < l_receiptdate) GROUP BY o_orderpriority ORDER BY o_orderpriority",
  "Q5": "SELECT n_name, sum(l_extendedprice * (1 - l_discount)) AS revenue FROM region JOIN nation ON r_regionkey = n_regionkey JOIN customer ON n_nationkey = c_nationkey JOIN orders ON c_custkey = o_custkey JOIN lineitem ON o_orderkey = l_orderkey JOIN supplier ON l_suppkey = s_suppkey AND n_nationkey = s_nationkey WHERE r_name = 'ASIA' AND o_orderdate >= DATE '1994-01-01' AND o_orderdate < DATE '1995-01-01' GROUP BY n_name ORDER BY revenue DESC",
  "Q6": "SELECT sum(l_extendedprice * l_discount) AS revenue FROM lineitem WHERE l_shipdate >= DATE '1994-01-01' AND l_shipdate < DATE '1995-01-01' AND l_discount BETWEEN 0.05 AND 0.07 AND l_quantity < 24",
  "Q7": "SELECT supp_nation, cust_nation, l_year, sum(volume) AS revenue FROM (SELECT n_supp.n_name AS supp_nation, n_cust.n_name AS cust_nation, year(l_shipdate) AS l_year, l_extendedprice * (1 - l_discount) AS volume FROM customer JOIN nation n_cust ON c_nationkey = n_cust.n_nationkey AND n_cust.n_name = 'FRANCE' JOIN orders ON c_custkey = o_custkey JOIN lineitem ON o_orderkey = l_orderkey JOIN supplier ON l_suppkey = s_suppkey JOIN nation n_supp ON s_nationkey = n_supp.n_nationkey AND n_supp.n_name = 'GERMANY' WHERE l_shipdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31' UNION ALL SELECT n_supp.n_name AS supp_nation, n_cust.n_name AS cust_nation, year(l_shipdate) AS l_year, l_extendedprice * (1 - l_discount) AS volume FROM customer JOIN nation n_cust ON c_nationkey = n_cust.n_nationkey AND n_cust.n_name = 'GERMANY' JOIN orders ON c_custkey = o_custkey JOIN lineitem ON o_orderkey = l_orderkey JOIN supplier ON l_suppkey = s_suppkey JOIN nation n_supp ON s_nationkey = n_supp.n_nationkey AND n_supp.n_name = 'FRANCE' WHERE l_shipdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31') shipping GROUP BY supp_nation, cust_nation, l_year ORDER BY supp_nation, cust_nation, l_year",
  "Q8": "SELECT o_year, sum(CASE WHEN nation = 'BRAZIL' THEN volume ELSE 0 END) / sum(volume) AS mkt_share FROM (SELECT year(o_orderdate) AS o_year, l_extendedprice * (1 - l_discount) AS volume, n2.n_name AS nation FROM part JOIN lineitem ON p_partkey = l_partkey JOIN supplier ON l_suppkey = s_suppkey JOIN orders ON l_orderkey = o_orderkey JOIN customer ON o_custkey = c_custkey JOIN nation n1 ON c_nationkey = n1.n_nationkey JOIN region ON n1.n_regionkey = r_regionkey AND r_name = 'AMERICA' JOIN nation n2 ON s_nationkey = n2.n_nationkey WHERE o_orderdate BETWEEN DATE '1995-01-01' AND DATE '1996-12-31' AND p_type = 'ECONOMY ANODIZED STEEL') all_nations GROUP BY o_year ORDER BY o_year",
  "Q9": "SELECT nation, o_year, sum(amount) AS sum_profit FROM (SELECT n_name AS nation, year(o_orderdate) AS o_year, l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity AS amount FROM part JOIN partsupp ON p_partkey = ps_partkey JOIN supplier ON ps_suppkey = s_suppkey JOIN lineitem ON p_partkey = l_partkey AND ps_suppkey = l_suppkey JOIN orders ON l_orderkey = o_orderkey JOIN nation ON s_nationkey = n_nationkey WHERE p_name LIKE '%green%') profit GROUP BY nation, o_year ORDER BY nation, o_year DESC",
  "Q10": "SELECT c_custkey, c_name, sum(l_extendedprice * (1 - l_discount)) AS revenue, c_acctbal, n_name, c_address, c_phone, c_comment FROM customer JOIN orders ON c_custkey = o_custkey JOIN lineitem ON o_orderkey = l_orderkey JOIN nation ON c_nationkey = n_nationkey WHERE o_orderdate >= DATE '1993-10-01' AND o_orderdate < DATE '1994-01-01' AND l_returnflag = 'R' GROUP BY c_custkey, c_name, c_acctbal, c_phone, n_name, c_address, c_comment ORDER BY revenue DESC LIMIT 20",
  "Q11": "SELECT ps_partkey, sum(ps_supplycost * ps_availqty) AS value FROM partsupp JOIN supplier ON ps_suppkey = s_suppkey JOIN nation ON s_nationkey = n_nationkey WHERE n_name = 'GERMANY' GROUP BY ps_partkey HAVING sum(ps_supplycost * ps_availqty) > (SELECT sum(ps_supplycost * ps_availqty) * {SF_FRACTION} FROM partsupp JOIN supplier ON ps_suppkey = s_suppkey JOIN nation ON s_nationkey = n_nationkey WHERE n_name = 'GERMANY') ORDER BY value DESC",
  "Q12": "SELECT l_shipmode, sum(CASE WHEN o_orderpriority = '1-URGENT' OR o_orderpriority = '2-HIGH' THEN 1 ELSE 0 END) AS high_line_count, sum(CASE WHEN o_orderpriority <> '1-URGENT' AND o_orderpriority <> '2-HIGH' THEN 1 ELSE 0 END) AS low_line_count FROM orders JOIN lineitem ON o_orderkey = l_orderkey WHERE l_shipmode IN ('MAIL', 'SHIP') AND l_commitdate < l_receiptdate AND l_shipdate < l_commitdate AND l_receiptdate >= DATE '1994-01-01' AND l_receiptdate < DATE '1995-01-01' GROUP BY l_shipmode ORDER BY l_shipmode",
  "Q13": "SELECT c_count, count(*) AS custdist FROM (SELECT c_custkey, count(o_orderkey) AS c_count FROM customer LEFT JOIN orders ON c_custkey = o_custkey AND o_comment NOT LIKE '%special%requests%' GROUP BY c_custkey) c_orders GROUP BY c_count ORDER BY custdist DESC, c_count DESC",
  "Q14": "SELECT 100.00 * sum(CASE WHEN p_type LIKE 'PROMO%' THEN l_extendedprice * (1 - l_discount) ELSE 0 END) / sum(l_extendedprice * (1 - l_discount)) AS promo_revenue FROM lineitem JOIN part ON l_partkey = p_partkey WHERE l_shipdate >= DATE '1995-09-01' AND l_shipdate < DATE '1995-10-01'",
  "Q15": "WITH revenue AS (SELECT l_suppkey AS supplier_no, sum(l_extendedprice * (1 - l_discount)) AS total_revenue FROM lineitem WHERE l_shipdate >= DATE '1996-01-01' AND l_shipdate < DATE '1996-04-01' GROUP BY supplier_no), max_rev AS (SELECT max(total_revenue) AS max_total_revenue FROM revenue) SELECT s_suppkey, s_name, s_address, s_phone, total_revenue FROM supplier JOIN revenue ON s_suppkey = supplier_no JOIN max_rev ON total_revenue = max_total_revenue ORDER BY s_suppkey",
  "Q16": "SELECT p_brand, p_type, p_size, count(DISTINCT ps_suppkey) AS supplier_cnt FROM part JOIN partsupp ON p_partkey = ps_partkey WHERE p_brand <> 'Brand#45' AND p_type NOT LIKE 'MEDIUM POLISHED%' AND p_size IN (49, 14, 23, 45, 19, 3, 36, 9) AND ps_suppkey NOT IN (SELECT s_suppkey FROM supplier WHERE s_comment LIKE '%Customer%Complaints%') GROUP BY p_brand, p_type, p_size ORDER BY supplier_cnt DESC, p_brand, p_type, p_size",
  "Q17": "WITH filtered AS (SELECT p.p_partkey, l.l_quantity, l.l_extendedprice FROM part p JOIN lineitem l ON p.p_partkey = l.l_partkey WHERE p.p_brand = 'Brand#23' AND p.p_container = 'MED BOX'), avg_qty AS (SELECT p_partkey, 0.2 * avg(l_quantity) AS avg_quantity FROM filtered GROUP BY p_partkey) SELECT sum(l_extendedprice) / 7.0 AS avg_yearly FROM filtered JOIN avg_qty USING (p_partkey) WHERE l_quantity < avg_quantity",
  "Q18": "WITH large_orders AS (SELECT l_orderkey FROM lineitem GROUP BY l_orderkey HAVING sum(l_quantity) > 300) SELECT c_name, c_custkey, o_orderkey, o_orderdate, o_totalprice, sum(l_quantity) FROM orders JOIN large_orders lo ON o_orderkey = lo.l_orderkey JOIN lineitem l ON o_orderkey = l.l_orderkey JOIN customer ON o_custkey = c_custkey GROUP BY c_name, c_custkey, o_orderkey, o_orderdate, o_totalprice ORDER BY o_totalprice DESC, o_orderdate LIMIT 100",
  "Q19": "SELECT sum(l_extendedprice * (1 - l_discount)) AS revenue FROM part JOIN lineitem ON p_partkey = l_partkey WHERE l_shipmode IN ('AIR', 'AIR REG') AND l_shipinstruct = 'DELIVER IN PERSON' AND ((p_brand = 'Brand#12' AND p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG') AND l_quantity BETWEEN 1 AND 11 AND p_size BETWEEN 1 AND 5) OR (p_brand = 'Brand#23' AND p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK') AND l_quantity BETWEEN 10 AND 20 AND p_size BETWEEN 1 AND 10) OR (p_brand = 'Brand#34' AND p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG') AND l_quantity BETWEEN 20 AND 30 AND p_size BETWEEN 1 AND 15))",
  "Q20": "WITH forest_parts AS (SELECT DISTINCT p_partkey FROM part WHERE p_name LIKE 'forest%'), lineitem_agg AS (SELECT l_partkey, l_suppkey, sum(l_quantity) * 0.5 AS sum_quantity FROM lineitem WHERE l_shipdate >= DATE '1994-01-01' AND l_shipdate < DATE '1995-01-01' GROUP BY l_partkey, l_suppkey), qualified_suppkeys AS (SELECT DISTINCT ps_suppkey FROM partsupp JOIN forest_parts ON ps_partkey = p_partkey JOIN lineitem_agg ON ps_suppkey = l_suppkey AND ps_partkey = l_partkey WHERE ps_availqty > sum_quantity) SELECT s_name, s_address FROM supplier JOIN nation ON s_nationkey = n_nationkey AND n_name = 'CANADA' JOIN qualified_suppkeys ON s_suppkey = ps_suppkey ORDER BY s_name",
  "Q21": "WITH multi_line_orders AS (SELECT l_orderkey FROM lineitem GROUP BY l_orderkey HAVING count(*) > 1), late_lines AS (SELECT l.l_orderkey, l.l_suppkey FROM multi_line_orders m JOIN lineitem l ON m.l_orderkey = l.l_orderkey WHERE l.l_receiptdate > l.l_commitdate), single_late_orders AS (SELECT l_orderkey FROM late_lines GROUP BY l_orderkey HAVING count(*) = 1) SELECT s_name, count(*) AS numwait FROM single_late_orders slo JOIN late_lines ll ON slo.l_orderkey = ll.l_orderkey JOIN supplier ON ll.l_suppkey = s_suppkey JOIN nation ON s_nationkey = n_nationkey AND n_name = 'SAUDI ARABIA' JOIN orders ON slo.l_orderkey = o_orderkey AND o_orderstatus = 'F' GROUP BY s_name ORDER BY numwait DESC, s_name LIMIT 100",
  "Q22": "WITH custsale AS (SELECT substr(c_phone, 1, 2) AS cntrycode, c_acctbal, c_custkey FROM customer WHERE substr(c_phone, 1, 2) IN ('13', '31', '23', '29', '30', '18', '17')), avg_bal AS (SELECT avg(c_acctbal) AS avg_acctbal FROM custsale WHERE c_acctbal > 0.0), has_orders AS (SELECT DISTINCT o_custkey FROM orders) SELECT cntrycode, count(*) AS numcust, sum(c_acctbal) AS totacctbal FROM custsale LEFT JOIN has_orders ON c_custkey = o_custkey CROSS JOIN avg_bal WHERE o_custkey IS NULL AND c_acctbal > avg_acctbal GROUP BY cntrycode ORDER BY cntrycode"
}
