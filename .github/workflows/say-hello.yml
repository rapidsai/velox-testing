#
# GitHub Actions Workflow Test
#

name: Say Hello

on:
  # run on a push or PR to main
  #push:
  #  branches: [ main ]
  #pull_request:
  #  branches: [ main ]
  
  # run manually from the Actions tab with a string parameter
  workflow_dispatch:
    inputs:
      recipient:
        description: 'To whom would you like to say Hello?'
        required: true
        default: "World"

jobs:
  say-hello:
    name: Say Hello
    runs-on: linux-amd64-gpu-l4-latest-1-8zn4h-runner-vh4wz
    #container: ghcr.io/facebookincubator/velox-dev:adapters
    defaults:
      run:
        shell: bash

    steps:
      # We don't actually need to checkout the repo
      #- name: Checkout repository
      #  uses: actions/checkout@v4

      # Say Hello
      - name: Say Hello
        run: echo "Hello, ${{ github.event.inputs.recipient }}!"
      
      - name: Create Virtual Environment
        run: python3 -m venv test_venv

      - name: Activate Virtual Environment
        run: source test_venv/bin/activate

      - name: Deactivate Virtual Environment
        run: deactivate

      - name: Delete Virtual Environment
        run: rm -rf test_venv

      # Run nvidia-smi just to prove we're on a GPU system
      - name: Run nvidia-smi
        run: nvidia-smi || echo "nvidia-smi not found or no NVIDIA GPU/driver detected!"
        continue-on-error: true
