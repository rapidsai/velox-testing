name: Presto Test
description: Tests for each type of presto configuration
on:
  workflow_dispatch:
    inputs:
      velox_commit:
        description: 'Velox commit SHA or branch'
        type: string
        required: false
        default: 'merged-prs'
      presto_commit:
        description: 'Presto commit SHA or branch'
        type: string
        required: false
        default: 'f31246e1ecce7cc1ea6b2fff34a0dc701fa9c5a9'
      run_java_tests:
        description: 'Run tests with java worker'
        type: boolean
        default: false
      run_cpu_tests:
        description: 'Run tests with native-cpu worker'
        type: boolean
        default: false
      run_gpu_tests:
        description: 'Run tests with native-gpu worker'
        type: boolean
        default: true

  workflow_call:
    inputs:
      velox_commit:
        description: 'Velox commit SHA or branch'
        type: string
        required: false
        default: 'merged-prs'
      presto_commit:
        description: 'Presto commit SHA or branch'
        type: string
        required: false
        default: 'f31246e1ecce7cc1ea6b2fff34a0dc701fa9c5a9'
      run_java_tests:
        description: 'Run tests with java worker'
        type: boolean
        default: true
      run_cpu_tests:
        description: 'Run tests with native-cpu worker'
        type: boolean
        default: true
      run_gpu_tests:
        description: 'Run tests with native-gpu worker'
        type: boolean
        default: true

jobs:
  temp:
    runs-on: 'ubuntu-latest'
    steps:
      - name: "Temp"
        echo: "conditional: ${{ inputs.run_java_tests }}"
  java:
    if: ${{ inputs.run_java_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:
      presto_worker_type: 'java'
      node_label: 'linux-amd64-cpu4'
      velox_commit: ${{ inputs.velox_commit }}
      presto_commit: ${{ inputs.presto_commit }}
  native-cpu:
    if: ${{ github.event.inputs.run_cpu_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:
      presto_worker_type: 'native_cpu'
      node_label: 'linux-amd64-cpu16'
      velox_commit: ${{ inputs.velox_commit }}
      presto_commit: ${{ inputs.presto_commit }}
  native-gpu:
    if: ${{ github.event.inputs.run_gpu_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:
      presto_worker_type: 'native_gpu'
      node_label: 'linux-amd64-gpu-l4-latest-1'
      velox_commit: ${{ inputs.velox_commit }}
      presto_commit: ${{ inputs.presto_commit }}

