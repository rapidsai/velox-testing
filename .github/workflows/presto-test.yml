name: Presto Test
description: Tests for each type of presto configuration
on:
  workflow_dispatch:
    inputs:
      velox_commit:
        description: 'Velox commit SHA or branch'
        type: string
        required: false
        default: 'main'
      presto_commit:
        description: 'Presto commit SHA or branch'
        type: string
        required: false
        default: 'master'
      presto_worker_type:
        description: 'Type of presto worker to use'
        type: choice
        required: false
        options:
          - java
          - native_cpu
          - native_gpu
        default: 'native_gpu'

jobs:
  build-java:
    if: ${{ github.event.inputs.presto_worker_type == 'java'}}
    uses: rapidsai/velox-testing/.github/workflows/presto-test-composite.yml@misiug/PrestoActions
    with:
      presto_worker_type: ${{ github.event.inputs.presto_worker_type }}
      node_label: 'linux-amd64-cpu4'
  build-native-cpu:
    if: ${{ github.event.inputs.presto_worker_type == 'native_cpu'}}
    uses: rapidsai/velox-testing/.github/workflows/presto-test-composite.yml@misiug/PrestoActions
    with:
      presto_worker_type: ${{ github.event.inputs.presto_worker_type }}
      node_label: 'linux-amd64-cpu16'
  build-native-gpu:
    if: ${{ github.event.inputs.presto_worker_type == 'native_gpu'}}
    uses: rapidsai/velox-testing/.github/workflows/presto-test-composite.yml@misiug/PrestoActions
    with:
      presto_worker_type: ${{ github.event.inputs.presto_worker_type }}
      node_label: 'linux-amd64-gpu-l4-latest-1'
