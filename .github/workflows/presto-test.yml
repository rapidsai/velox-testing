name: Presto Test
description: Tests for each type of presto configuration
on:
  workflow_dispatch:
    inputs:
      presto_repository:
        description: 'Presto Repository'
        type: string
        required: false
        default: 'prestodb/presto'
      presto_commit:
        description: 'Presto Commit SHA or Branch'
        type: string
        required: false
        default: 'master'
      velox_repository:
        description: 'Velox Repository'
        type: string
        required: false
        default: 'facebookincubator/velox'
      velox_commit:
        description: 'Velox Commit SHA or Branch'
        type: string
        required: false
        default: 'main'
      velox_testing_commit:
        description: 'Velox Testing Commit SHA or Branch'
        type: string
        required: false
        default: 'main'
      run_java_tests:
        description: 'Run tests with Java Worker'
        type: boolean
        default: false
      run_cpu_tests:
        description: 'Run tests with Native CPU Worker'
        type: boolean
        default: false
      run_gpu_tests:
        description: 'Run tests with Native GPU Worker'
        type: boolean
        default: true

jobs:
  java:
    if: ${{ github.event.inputs.run_java_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:      
      presto_worker_type: 'java'
      node_label: 'linux-amd64-cpu4'
      presto_repository: ${{ inputs.presto_repository }}
      presto_commit: ${{ inputs.presto_commit }}
      velox_repository: ${{ inputs.velox_repository }}
      velox_commit: ${{ inputs.velox_commit }}
      velox_testing_commit: ${{ inputs.velox_testing_commit }}
    secrets: inherit
  native-cpu:
    if: ${{ github.event.inputs.run_cpu_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:
      presto_worker_type: 'native_cpu'
      node_label: 'linux-amd64-cpu16'
      presto_repository: ${{ inputs.presto_repository }}
      presto_commit: ${{ inputs.presto_commit }}
      velox_repository: ${{ inputs.velox_repository }}
      velox_commit: ${{ inputs.velox_commit }}
      velox_testing_commit: ${{ inputs.velox_testing_commit }}
    secrets: inherit
  native-gpu:
    if: ${{ github.event.inputs.run_gpu_tests == 'true' }}
    uses: ./.github/workflows/presto-test-composite.yml
    with:
      presto_worker_type: 'native_gpu'
      node_label: 'linux-amd64-gpu-l4-latest-1'
      presto_repository: ${{ inputs.presto_repository }}
      presto_commit: ${{ inputs.presto_commit }}
      velox_repository: ${{ inputs.velox_repository }}
      velox_commit: ${{ inputs.velox_commit }}
      velox_testing_commit: ${{ inputs.velox_testing_commit }}
    secrets: inherit
